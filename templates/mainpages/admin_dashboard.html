{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="container mt-5">
  <div class="row gx-4 justify-content-start align-items-start mb-5">
    <!-- User Overview with Chart -->
    <div class="col-md-6 mb-4">
      <div class="card shadow border-0 rounded-4 p-4 h-100" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
        <h5 class="card-title mb-3 fw-bold">User Overview</h5>
        <p class="mb-4 fs-5">Total Users: <span class="badge bg-light text-dark fs-6">{{ total_users }}</span></p>

        <canvas id="userStatusChart" style="max-height: 320px;"></canvas>
      </div>
    </div>

    <!-- Manage Users Card -->
    <div class="col-md-5 mb-4">
      <a href="{% url 'manage_users' %}" class="text-decoration-none">
        <div class="card shadow border-0 rounded-4 h-100 hover-shadow transition bg-white">
          <div class="card-body d-flex flex-column justify-content-center align-items-center py-5">
            <div class="mb-4">
              <i class="bi bi-people-fill" style="font-size: 3.5rem; color: #6f42c1;"></i>
            </div>
            <h4 class="card-title fw-bold text-primary mb-3">Manage Users</h4>
            <p class="card-text text-secondary fs-6 text-center px-3">
              View, activate/deactivate, and assign roles to system users.
            </p>
            <div class="mt-4">
              <button class="btn btn-primary px-4 py-2 shadow-sm fw-semibold">
                Go to Users <i class="bi bi-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>

  <!-- Users Table -->
  <div class="card shadow-sm rounded-4 border-0">
    <div class="card-body">
      <h5 class="card-title mb-4 fw-bold text-secondary">Latest Users</h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Username</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Verified</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td><span class="badge bg-secondary text-uppercase">{{ user.get_role_display }}</span></td>
              <td>
                {% if user.is_active %}
                  <span class="badge bg-success">Active</span>
                {% else %}
                  <span class="badge bg-danger">Inactive</span>
                {% endif %}
              </td>
              <td>
                {% if user.is_verified %}
                  <span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Verified</span>
                {% else %}
                  <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle-fill"></i> Not Verified</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-muted">No users to display.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('userStatusChart').getContext('2d');
  const userStatusChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Active', 'Inactive', 'Verified', 'Unverified'],
      datasets: [{
        label: 'User Status',
        data: [
          {{ active_users }},
          {{ inactive_users }},
          {{ verified_users }},
          {{ unverified_users }}
        ],
        backgroundColor: [
          '#198754', // green
          '#dc3545', // red
          '#0d6efd', // blue
          '#ffc107'  // yellow
        ],
        borderColor: 'rgba(255, 255, 255, 0.8)',
        borderWidth: 2,
        hoverOffset: 40
      }]
    },
    options: {
      responsive: true,
      cutout: '65%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: 'white',
            font: {
              size: 14,
              weight: '600'
            }
          }
        },
        tooltip: {
          enabled: true,
          backgroundColor: '#333',
          titleColor: '#fff',
          bodyColor: '#eee'
        }
      }
    }
  });
</script>

<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  .hover-shadow:hover {
    box-shadow: 0 0 1.25rem rgba(111, 66, 193, 0.5);
    transform: translateY(-6px);
    transition: all 0.25s ease-in-out;
  }

  /* Card rounded corners and smooth shadow for modern look */
  .card {
    border-radius: 1rem !important;
  }

  /* Button hover */
  .btn-primary:hover {
    background-color: #5a32b1;
    box-shadow: 0 6px 12px rgba(90, 50, 177, 0.6);
    transition: all 0.3s ease;
  }
</style>
{% endblock %}
