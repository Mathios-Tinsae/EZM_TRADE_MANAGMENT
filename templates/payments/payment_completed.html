{% extends 'base_sidebar.html' %}
{% load static %}

{% block title %}Payment Completed - EZM Trade Management{% endblock %}

{% block extra_css %}
<style>
    .payment-success-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
    }

    .success-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(135deg, #45A29E 0%, #66FCF1 100%);
        border-radius: 15px;
        color: white;
        box-shadow: 0 8px 32px rgba(69, 162, 158, 0.3);
    }

    .success-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: checkmark 0.6s ease-in-out;
    }

    @keyframes checkmark {
        0% {
            transform: scale(0);
        }

        50% {
            transform: scale(1.2);
        }

        100% {
            transform: scale(1);
        }
    }

    .success-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }

    .success-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
    }

    .payment-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .detail-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }

    .detail-card h3 {
        color: var(--accent-teal);
        font-size: 1.3rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .detail-item:last-child {
        border-bottom: none;
    }

    .detail-label {
        font-weight: 500;
        color: var(--text-secondary);
    }

    .detail-value {
        font-weight: 600;
        color: var(--text-primary);
    }

    .order-summary {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }

    .order-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .order-item:last-child {
        border-bottom: none;
        font-weight: bold;
        font-size: 1.1rem;
        color: var(--accent-teal);
    }

    .item-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .item-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    .item-details {
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .next-steps {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }

    .step-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
    }

    .step-item:last-child {
        border-bottom: none;
    }

    .step-number {
        background: var(--accent-teal);
        color: white;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
    }

    .step-content {
        flex: 1;
    }

    .step-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .step-description {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-primary-custom {
        background: linear-gradient(135deg, var(--accent-teal) 0%, var(--accent-cyan) 100%);
        color: white;
        border: none;
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .btn-primary-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(69, 162, 158, 0.3);
        color: white;
        text-decoration: none;
    }

    .btn-secondary-custom {
        background: transparent;
        color: var(--accent-teal);
        border: 2px solid var(--accent-teal);
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .btn-secondary-custom:hover {
        background: var(--accent-teal);
        color: white;
        text-decoration: none;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .status-success {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    @media (max-width: 768px) {
        .payment-details {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            flex-direction: column;
            align-items: center;
        }

        .success-title {
            font-size: 2rem;
        }

        .success-subtitle {
            font-size: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="payment-success-container">
    <!-- Success Header -->
    <div class="success-header">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h1 class="success-title">Payment Completed!</h1>
        <p class="success-subtitle">Your order has been successfully processed and payment confirmed.</p>
    </div>

    <!-- Payment Details -->
    <div class="payment-details">
        <!-- Transaction Information -->
        <div class="detail-card">
            <h3>
                <i class="fas fa-receipt"></i>
                Transaction Details
            </h3>
            <div class="detail-item">
                <span class="detail-label">Transaction ID:</span>
                <span class="detail-value">{{ display_data.transaction_id|default:transaction.chapa_tx_ref }}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Customer Name:</span>
                <span class="detail-value">
                    {% if display_data.customer_name %}
                    {{ display_data.customer_name }}
                    {% else %}
                    {{ transaction.customer_first_name }} {{ transaction.customer_last_name }}
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Customer Email:</span>
                <span class="detail-value">
                    {% if display_data.customer_email %}
                    {{ display_data.customer_email }}
                    {% else %}
                    {{ transaction.customer_email }}
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Payment Date:</span>
                <span class="detail-value">
                    {% if display_data.payment_date %}
                    {{ display_data.payment_date|date:"M d, Y - H:i" }}
                    {% else %}
                    {{ transaction.paid_at|date:"M d, Y - H:i" }}
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Payment Method:</span>
                <span class="detail-value">{{ display_data.payment_method|default:"Chapa Payment Gateway" }}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Status:</span>
                <span class="status-badge status-success">
                    <i class="fas fa-check"></i>
                    Completed
                </span>
            </div>
        </div>

        <!-- Order Information -->
        <div class="detail-card">
            <h3>
                <i class="fas fa-box"></i>
                Order Information
            </h3>
            <div class="detail-item">
                <span class="detail-label">Supplier:</span>
                <span class="detail-value">
                    {% if display_data.supplier_name %}
                    {{ display_data.supplier_name }}
                    {% else %}
                    {{ transaction.supplier.name }}
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Total Amount:</span>
                <span class="detail-value">
                    ETB {% if display_data.amount %}{{ display_data.amount|floatformat:2 }}{% else %}{{
                    transaction.amount|floatformat:2 }}{% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Currency:</span>
                <span class="detail-value">
                    {% if display_data.currency %}
                    {{ display_data.currency }}
                    {% else %}
                    {{ transaction.currency }}
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Order Date:</span>
                <span class="detail-value">
                    {% if display_data.order_date %}
                    {{ display_data.order_date|date:"M d, Y - H:i" }}
                    {% else %}
                    {{ transaction.created_at|date:"M d, Y - H:i" }}
                    {% endif %}
                </span>
            </div>
            {% if transaction_created %}
            <div class="detail-item">
                <span class="detail-label">Transaction Record:</span>
                <span class="detail-value">
                    <span class="status-badge status-success">
                        <i class="fas fa-database"></i>
                        Created Successfully
                    </span>
                </span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Order Summary -->
    {% if order_items %}
    <div class="order-summary">
        <h3 style="color: var(--accent-teal); margin-bottom: 1rem;">
            <i class="fas fa-list"></i>
            Order Summary
        </h3>
        {% for item in order_items %}
        <div class="order-item">
            <div class="item-info">
                <div class="item-name">{{ item.product_name }}</div>
                <div class="item-details">Quantity: {{ item.quantity }} × ETB {{ item.price|floatformat:2 }}</div>
            </div>
            <div class="detail-value">ETB {{ item.total_price|floatformat:2 }}</div>
        </div>
        {% endfor %}
        <div class="order-item">
            <div class="item-info">
                <div class="item-name">Total Amount</div>
            </div>
            <div class="detail-value">
                ETB {% if display_data.amount %}{{ display_data.amount|floatformat:2 }}{% else %}{{
                transaction.amount|floatformat:2 }}{% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Next Steps -->
    <div class="next-steps">
        <h3 style="color: var(--accent-teal); margin-bottom: 1rem;">
            <i class="fas fa-route"></i>
            What Happens Next?
        </h3>
        <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
                <div class="step-title">Order Confirmation</div>
                <div class="step-description">Your supplier has been notified and will begin processing your order.
                </div>
            </div>
        </div>
        <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
                <div class="step-title">Order Preparation</div>
                <div class="step-description">The supplier will prepare your items and arrange for delivery or pickup.
                </div>
            </div>
        </div>
        <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
                <div class="step-title">Delivery/Pickup</div>
                <div class="step-description">You'll receive updates on delivery status and estimated arrival time.
                </div>
            </div>
        </div>
        <div class="step-item">
            <div class="step-number">4</div>
            <div class="step-content">
                <div class="step-title">Order Complete</div>
                <div class="step-description">Confirm receipt of your items to complete the transaction.</div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="{% url 'purchase_order_list' %}" class="btn-primary-custom">
            <i class="fas fa-list-alt"></i>
            View Purchase Orders
        </a>
        <a href="{% url 'payment_history' %}" class="btn-secondary-custom">
            <i class="fas fa-history"></i>
            Payment History
        </a>
        <a href="{% url 'head_manager_page' %}" class="btn-secondary-custom">
            <i class="fas fa-home"></i>
            Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add some interactive effects
    document.addEventListener('DOMContentLoaded', function () {
        // Animate cards on load
        const cards = document.querySelectorAll('.detail-card, .order-summary, .next-steps');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });

        // Add hover effects to buttons
        const buttons = document.querySelectorAll('.btn-primary-custom, .btn-secondary-custom');
        buttons.forEach(button => {
            button.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-2px)';
            });
            button.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
            });
        });
    });
</script>
{% endblock %}